---
title: "NHP Parameters Report"
subtitle: "Scenario: `r params$r$params$scenario`"
output:
  html_document:
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
params:
  r: NA
---

```{r}
#| label: setup
#| echo: false

knitr::opts_chunk$set(error = TRUE, echo = FALSE)

# Check if fct_report functions are loaded by seeing if one exists in the env
# (allows for both local and remote rendering)
if (!exists("mod_info_downloads_download_json")) {
  source(
    here::here("R", "fct_report.R"),
    local = knitr::knit_global()
  )
}
```

```{css}
h1 {
  font-size: 32px;
}

h2 {
  font-size: 28px;
}

h3 {
  font-size: 26px;
}

h4 {
  font-size: 24px;
}

h5 {
  font-size: 22px;
}

h6 {
  font-size: 20px;
}

p {
  font-size: 16px;
}
```

```{r}
#| label: setup-params

p <- get_params(params$r)
t_profile <- params$r$params$time_profile_mappings
```

# Notes

This report provides the parameter selections for the selected model scenario (`r params$r$params$scenario`) and the rationale given for these choices.

See [the model project information site](https://connect.strategyunitwm.nhs.uk/nhp/project_information) for an overview, user guide and methodology for the model and the outputs app.

# Metadata

This table shows the metadata for the selected model run:

```{r}
#| label: params-model-run

tabulate_model_run_info(p)
```

# Parameters

## Demographic adjustment

```{r}
#| label: params-demographic-adjustment

info_params_table_demographic_adjustment(p) |> 
  gt::tab_options(table.align = "left")
```

## Baseline adjustment

```{r}
#| label: params-baseline-adjustment

info_params_table_baseline_adjustment(p) |> 
  gt::tab_options(table.align = "left")
```

## Covid adjustment

```{r}
#| label: params-covid-adjustment

info_params_table_covid_adjustment(p) |> 
  gt::tab_options(table.align = "left")
```

## Waiting list adjustment

Time profile: `r t_profile[["waiting_list_adjustment"]]`

```{r}
#| label: params-waiting-list-adjustment

info_params_table_waiting_list_adjustment(p) |> 
  gt::tab_options(table.align = "left")
```

## Expatriation

Time profile: `r t_profile[["expat"]]`

```{r}
#| label: params-expat

info_params_table_expat_repat_adjustment(p, "expat") |> 
  gt::tab_options(table.align = "left")
```

## Repatriation (local)

Time profile: `r t_profile[["repat_local"]]`

```{r}
#| label: params-repat-local

info_params_table_expat_repat_adjustment(p, "repat_local") |> 
  gt::tab_options(table.align = "left")
```

## Repatriation (non-local)

Time profile: `r t_profile[["repat_nonlocal"]]`

```{r}
#| label: params-repat-non-local

info_params_table_expat_repat_adjustment(p, "repat_nonlocal") |> 
  gt::tab_options(table.align = "left")
```

## Non-demographic adjustment

```{r}
#| label: params-non-demographic-adjustment

info_params_table_non_demographic_adjustment(p) |> 
  gt::tab_options(table.align = "left")
```

## Activity avoidance

```{r}
#| label: params-activity-avoidance

info_params_table_activity_avoidance(p) |> 
  gt::tab_options(table.align = "left")
```

## Efficiencies

```{r}
#| label: params-efficiencies

info_params_table_efficiencies(p) |> 
  gt::tab_options(table.align = "left")
```

## Bed occupancy

```{r}
#| label: params-bed-occupancy-day-night

info_params_table_bed_occupancy_day_night(p) |> 
  gt::tab_options(table.align = "left")
```

```{r}
#| label: params-bed-occupancy-specialty-mapping

info_params_table_bed_occupancy_specialty_mapping(p) |> 
  gt::tab_options(table.align = "left")
```

# Rationale

```{r echo=F, results='asis'}
reasons <- p$reasons

if (is.null(reasons)) {
  cat("No rationale provided.\n\n")
} else {
  expand_reasons_to_rmd(reasons)
}
```
